# PPT讲解图像序列去重优化完整需求与GUI实现

## 输入数据结构
- **根目录**：输出目录，如`output/`
- **分段子文件夹**：以时间段命名，如`segment_90.0_120.0/`表示90-120秒片段
- **图像文件**：每个子文件夹内包含形如`frame_5.png`的图像序列
  - 文件命名为数字递增(无固定位数)，如`frame_5.png`, `frame_6.png`...`frame_10.png`
  - 每个文件夹内的帧序号都是独立从1开始编号的
  - 需要正确数字排序（确保`frame_10.png`不会排在`frame_2.png`之前）
  - 原始图像序列已是间隔采样（非逐帧），不代表精确时间点

## 处理需求
1. **去重目标**：
   - 比对图像序列，识别相似图像
   - 保留差异超过阈值(5%)的图像，去除相似图像
   - 阈值需可调整，允许少量误判

2. **处理方法**：
   - 提供多种比对算法选项（哈希比对、像素比对或混合模式）
   - 采用两级筛选策略：
     - 第一级：粗筛（间隔采样+快速哈希）识别变化段
     - 第二级：精筛（精确算法）确认需保留的关键帧

3. **性能要求**：
   - 高效处理1-2小时(分辨率1920×1080)的图像序列
   - 利用并行处理加速不同分段的处理

## 输出需求
- **输出模式选择**：
  - **模式1-原地删除**：直接从原始文件夹中删除判定为冗余的图像
  - **模式2-新建复制**：将判定需保留的图像复制到新目标文件夹，不修改原始文件夹
  - **模式3-新建删除**：将判定需保留的图像复制到新目标文件夹，然后删除原始文件夹以释放空间

- **全局序列处理**：
  - 当选择模式2或模式3时，需创建全局序列编号
  - 不需要精确反映时间点，只需保证全局顺序正确
  - 可基于文件夹顺序和内部帧号创建统一的递增编号序列

- **跨片段去重**：合并后需再次扫描不同片段交界处的图像，确保消除跨片段的重复图像

- **用途**：输出图像将用于后续ROI区域提取

## GUI界面需求
- **基于Tkinter实现简洁易用的图形界面**
- **界面元素包括**：
  - 输入目录选择（可浏览）
  - 输出目录选择（可浏览，适用于模式2和模式3）
  - 处理模式选择（单选按钮或下拉菜单）
  - 算法参数设置区域：
    - 相似度阈值调整滑块（默认5%，范围1-10%）
    - 比对算法选择（哈希比对、像素比对、混合模式）
    - 采样间隔设置（用于粗筛阶段）
  - 处理按钮（开始处理、停止处理）
  - 进度显示区域（进度条和文本信息）
  - 结果统计区域（显示处理结果统计信息）
  - 日志显示区域（滚动文本框显示详细日志）

- **界面功能**：
  - 参数设置保存/加载功能
  - 处理前预估功能（估算处理时间和结果）
  - 实时进度更新和统计信息显示
  - 出错时显示错误信息和建议

## 处理流程
1. **初始化**：
   - 通过GUI界面收集用户设置的参数
   - 扫描输出目录结构，识别所有分段文件夹
   - 解析文件夹名称中的时间信息，建立分段顺序
   - 为每个分段创建正确排序的文件列表（处理数字排序问题）

2. **分段内去重**：
   - 对每个时间段文件夹内的图像序列进行去重处理
   - 粗筛：根据用户设置的采样间隔进行采样，标记变化段和稳定段
   - 精筛：对变化段进行全帧精确比对，对稳定段保留代表帧
   - 在GUI上实时更新处理进度和统计信息

3. **动态基准更新**：
   - 从每个分段的第一帧开始作为初始基准
   - 每当检测到差异超过用户设置阈值的帧，保留该帧并设为新基准

4. **跨片段去重**：
   - 检查相邻时间段的末尾帧与起始帧的相似度
   - 如果片段交界处的图像相似度高于阈值，标记其中一个为冗余

5. **结果处理**（根据选择模式）：
   - **模式1-原地删除**：
     - 直接删除原始文件夹中标记为冗余的图像
     - 保留原始文件夹结构和文件命名

   - **模式2-新建复制**：
     - 创建新的目标文件夹
     - 复制所有保留的图像到目标文件夹
     - 使用新的全局序列编号重命名
     - 不改动原始文件夹

   - **模式3-新建删除**：
     - 创建新的目标文件夹并复制保留的图像
     - 使用新的全局序列编号重命名
     - 处理完成后删除原始分段文件夹以释放空间

6. **并行处理优化**：
   - 分段内去重可并行处理
   - 跨片段去重需在分段处理完成后串行执行
   - 根据选择模式执行相应的结果处理操作
   - 在GUI上显示多线程处理状态和进度

## 特殊考虑
- **文件排序**：实现正确的数字排序，确保`frame_2.png`排在`frame_10.png`之前
- **全局序列编号**：
  - 不需反映精确时间点，只需保证正确顺序
  - 可采用简单递增编号（如从1开始连续编号）
  - 或基于原始文件夹顺序和内部帧号创建有意义的编号方案
- **交界处理**：特别关注相邻时间段的交界处图像比对，避免因切片导致的重复
- **操作安全性**：
  - 提供确认机制，特别是对于删除操作（模式1和模式3）
  - 可选择先执行模拟运行，显示将被保留/删除的文件数量和比例
- **结果统计**：
  - 提供每个分段和全局的去重统计信息
  - 包括原始图像数量、保留图像数量、压缩率等
  - 在GUI上以图表形式直观展示
- **内存管理**：限制同时加载的图像数量，避免内存溢出
- **进度报告**：在GUI上提供清晰的进度指示和估计完成时间
- **错误处理**：
  - 捕获和显示处理过程中的错误
  - 提供恢复和继续处理的选项
  - 对关键操作（如删除）提供撤销功能
- **用户设置保存**：
  - 保存用户首选的参数设置
  - 提供配置文件导入/导出功能

这个完整的解决方案将通过直观的GUI界面，为用户提供便捷的PPT讲解图像序列去重工具。系统将在分段内和跨分段两个层面去除冗余相似图像，提供三种灵活的输出模式，并允许用户通过界面调整关键参数。正确处理文件排序问题，确保全局序列的顺序正确性，同时为后续ROI提取做好充分准备。